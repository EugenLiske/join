<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: contacts/contacts_list_overlays.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: contacts/contacts_list_overlays.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// MF - contacts_list_overlays.js
/**
 * Contacts List - Overlay Management
 * Handles Add/Edit contact overlays
 */

import { FIREBASE_URL, FIREBASE_PATHS, STORAGE_KEYS } from "../config.js";

import {
  loadAllContacts,
  contactsData,
  showToastMessage,
} from "./contacts_list_data.js";
import {
  selectContactById,
  getCurrentSelectedContact,
} from "./contacts_list_selection.js";
import { closeMobileActionMenu } from "./contacts_list_mobile.js";

// ================== DOM ELEMENTS ==================
const contactDetailsPanel = document.getElementById("contact_details_panel");

// ================== OVERLAY LOADING ==================

/**
 * Opens the Add Contact overlay
 */
export async function openAddContactOverlay() {
  try {
    if (document.activeElement) {
          document.activeElement.blur();
      }
    const html = await loadOverlayHTML(
      "../overlays/contacts/contacts_add.html"
    );
    showOverlay("add_contact_overlay", html);

    await loadContactScripts();
    initializeAddContactOverlay();
  } catch (error) {
    // Error handling
  }
}

/**
 * Opens the Edit Contact overlay for selected contact
 */
export async function editSelectedContact() {
  const currentContact = getCurrentSelectedContact();
  if (!currentContact) return;

  try {
    document.body.classList.remove("mobile_view_contact_details");
    localStorage.setItem(STORAGE_KEYS.CURRENT_EDIT_ID, currentContact.id);

    await loadAndShowEditOverlay();
  } catch (error) {
    // Error handling
  }
}

async function loadAndShowEditOverlay() {
  const html = await loadOverlayHTML("../overlays/contacts/contacts_edit.html");
  showOverlay("edit_contact_overlay", html);

  await loadContactScripts();
  initializeEditContactOverlay();
}

async function loadOverlayHTML(path) {
  const response = await fetch(path);
  return await response.text();
}

function showOverlay(overlayId, html) {
  const overlay = document.getElementById(overlayId);
  overlay.innerHTML = html;
  overlay.classList.remove("d_none");
  document.body.style.overflow = "hidden";
}

/**
 * Loads contact scripts dynamically
 */
async function loadContactScripts() {
  return new Promise((resolve) => {
    if (window.saveContact) {
      resolve();
      return;
    }

    const script = document.createElement("script");
    script.src = "../scripts/contacts/contacts_form_main.js";
    script.type = "module";
    script.onload = resolve;
    document.head.appendChild(script);
  });
}

// ================== DELETE FUNCTIONALITY ==================

/**
 * Deletes the selected contact
 */
export async function deleteSelectedContact() {
  const currentContact = getCurrentSelectedContact();
  if (!currentContact) return;

  try {
    closeMobileActionMenu();

    const response = await fetch(
      `${FIREBASE_URL}${FIREBASE_PATHS.SINGLE_CONTACT(currentContact.id)}`,
      {
        method: "DELETE",
      }
    );

    if (!response.ok) {
      throw new Error("Failed to delete contact");
    }

    showToastMessage("Contact deleted successfully", "success");

    contactDetailsPanel.classList.add("d_none");

    setTimeout(() => {
      loadAllContacts();
    }, 1000);
  } catch (error) {
    showToastMessage("Error deleting contact. Please try again.", "error");
  }
}

// ================== ADD OVERLAY INITIALIZATION ==================

function initializeAddContactOverlay() {
  setupOverlayCloseHandlers("add_contact_overlay", closeAddContactOverlay);
  setupInputEventListeners();
  wrapSaveContactForAdd();
}

function setupOverlayCloseHandlers(overlayId, closeCallback) {
  const closeBtn = document.querySelector(`#${overlayId} .close_button`);
  if (closeBtn) {
    closeBtn.onclick = closeCallback;
  }

  const overlay = document.getElementById(overlayId);
  overlay.onclick = (e) => {
    if (e.target === overlay) {
      closeCallback();
    }
  };
}

function setupInputEventListeners() {
  setTimeout(() => {
    const nameInput = document.getElementById("name_input");
    const emailInput = document.getElementById("email_input");
    const phoneInput = document.getElementById("telephone_input");

    if (nameInput)
      nameInput.addEventListener("input", window.validateContactForm);
    if (emailInput)
      emailInput.addEventListener("input", window.validateContactForm);
    if (phoneInput)
      phoneInput.addEventListener("input", window.validateContactForm);

    if (window.validateContactForm) {
      window.validateContactForm();
    }
  }, 100);
}

function wrapSaveContactForAdd() {
  const originalSaveContact = window.saveContact;
  window.saveContact = async (event) => {
    const result = await originalSaveContact(event);
    if (result !== false) {
      handleSuccessfulContactAdd();
    }
    return result;
  };
}

async function handleSuccessfulContactAdd() {
  closeAddContactOverlay();
  showToastMessage("Contact created successfully", "success");

  setTimeout(async () => {
    await loadAllContacts();
    selectNewestContact();
  }, 1000);
}

function selectNewestContact() {
  const allContacts = Object.values(contactsData).filter((c) => c &amp;&amp; c.id);
  const newestContact = allContacts.reduce((prev, current) => {
    return prev.id > current.id ? prev : current;
  });

  if (newestContact) {
    selectContactById(newestContact.id);
  }
}

function closeAddContactOverlay() {
  const overlay = document.getElementById("add_contact_overlay");
  overlay.classList.add("d_none");
  overlay.innerHTML = "";
}

// ================== EDIT OVERLAY INITIALIZATION ==================

function initializeEditContactOverlay() {
  setupOverlayCloseHandlers("edit_contact_overlay", closeEditContactOverlay);
  populateEditForm();
  setupEditInputEventListeners();
  wrapSaveContactForEdit();
}

function populateEditForm() {
    const currentContact = getCurrentSelectedContact();
    if (!currentContact) {
        return;
    }
    
    setTimeout(() => {
        fillFormInputs(currentContact);
        
        const contactAvatar = document.getElementById('contact_avatar');
        if (contactAvatar &amp;&amp; currentContact.avatarColor) {
            contactAvatar.style.backgroundColor = currentContact.avatarColor;
        }
        
        if (window.validateContactForm) {
            window.validateContactForm();
        }
    }, 200);
}

function fillFormInputs(contact) {
    const nameInput = document.getElementById('name_input');
    const emailInput = document.getElementById('email_input');
    const phoneInput = document.getElementById('telephone_input');
    if (nameInput) nameInput.value = contact.name || '';
    if (emailInput) emailInput.value = contact.email || '';
    if (phoneInput) phoneInput.value = contact.phone || '';
}

function setupEditInputEventListeners() {
  setTimeout(() => {
    const nameInput = document.getElementById("name_input");
    const emailInput = document.getElementById("email_input");
    const phoneInput = document.getElementById("telephone_input");

    if (nameInput)
      nameInput.addEventListener("input", window.validateContactForm);
    if (emailInput)
      emailInput.addEventListener("input", window.validateContactForm);
    if (phoneInput)
      phoneInput.addEventListener("input", window.validateContactForm);

    if (window.validateContactForm) {
      window.validateContactForm();
    }
  }, 200);
}

function wrapSaveContactForEdit() {
  const currentContact = getCurrentSelectedContact();
  const originalSaveContact = window.saveContact;

  window.saveContact = async (event) => {
    const editedContactId = currentContact?.id;
    const result = await executeSaveContact(originalSaveContact, event);

    if (result === true) {
      handleSuccessfulContactEdit(editedContactId);
    }

    return result;
  };
}

async function executeSaveContact(originalSaveContact, event) {
  try {
    return await originalSaveContact(event);
  } catch (error) {
    return false;
  }
}

function handleSuccessfulContactEdit(editedContactId) {
  closeEditContactOverlay();
  showToastMessage("Contact updated successfully", "success");

  setTimeout(async () => {
    await loadAllContacts();
    if (editedContactId) {
      selectContactById(editedContactId);
    }
  }, 1000);
}

function closeEditContactOverlay() {
  const overlay = document.getElementById("edit_contact_overlay");
  overlay.classList.add("d_none");
  overlay.innerHTML = "";
  document.body.style.overflow = ''
  localStorage.removeItem(STORAGE_KEYS.CURRENT_EDIT_ID);

  closeMobileActionMenu();

  const currentContact = getCurrentSelectedContact();
  if (window.innerWidth &lt;= 600 &amp;&amp; currentContact) {
    setTimeout(() => {
      document.body.classList.add("mobile_view_contact_details");
    }, 100);
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#assignRandomAvatarColor">assignRandomAvatarColor</a></li><li><a href="global.html#checkCategory">checkCategory</a></li><li><a href="global.html#checkCategorySelection">checkCategorySelection</a></li><li><a href="global.html#checkDate">checkDate</a></li><li><a href="global.html#checkDateFormat">checkDateFormat</a></li><li><a href="global.html#checkDuedate">checkDuedate</a></li><li><a href="global.html#checkEmailExists">checkEmailExists</a></li><li><a href="global.html#checkEmailExistsForEdit">checkEmailExistsForEdit</a></li><li><a href="global.html#checkIfOldSubtaskExists">checkIfOldSubtaskExists</a></li><li><a href="global.html#checkLoginEnable">checkLoginEnable</a></li><li><a href="global.html#checkNumberInterval">checkNumberInterval</a></li><li><a href="global.html#checkRequiredFields">checkRequiredFields</a></li><li><a href="global.html#checkRequiredFieldsToEnableButton">checkRequiredFieldsToEnableButton</a></li><li><a href="global.html#checkSingleUserMatch">checkSingleUserMatch</a></li><li><a href="global.html#checkTitle">checkTitle</a></li><li><a href="global.html#clearFormInputs">clearFormInputs</a></li><li><a href="global.html#clearPriorityButtons">clearPriorityButtons</a></li><li><a href="global.html#closeEditContact">closeEditContact</a></li><li><a href="global.html#closeMobileActionMenu">closeMobileActionMenu</a></li><li><a href="global.html#createContactDropDownSearchList">createContactDropDownSearchList</a></li><li><a href="global.html#createContactDropDownSearchListElement">createContactDropDownSearchListElement</a></li><li><a href="global.html#createContactElement">createContactElement</a></li><li><a href="global.html#createSuccessOverlayLogin">createSuccessOverlayLogin</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#dateValidation">dateValidation</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactFromFirebase">deleteContactFromFirebase</a></li><li><a href="global.html#deleteContactFromSuccessPage">deleteContactFromSuccessPage</a></li><li><a href="global.html#deleteSelectedContact">deleteSelectedContact</a></li><li><a href="global.html#displayContactDataInForm">displayContactDataInForm</a></li><li><a href="global.html#displayContactDetails">displayContactDetails</a></li><li><a href="global.html#displayContactsList">displayContactsList</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#editSelectedContact">editSelectedContact</a></li><li><a href="global.html#emailInput">emailInput</a></li><li><a href="global.html#extractSubtaskNrFromId">extractSubtaskNrFromId</a></li><li><a href="global.html#findMatchingUser">findMatchingUser</a></li><li><a href="global.html#generateInitials">generateInitials</a></li><li><a href="global.html#getAllUsers">getAllUsers</a></li><li><a href="global.html#getAssignedPersons">getAssignedPersons</a></li><li><a href="global.html#getCheckbox">getCheckbox</a></li><li><a href="global.html#getCheckboxImg">getCheckboxImg</a></li><li><a href="global.html#getContactNameSearchIndices">getContactNameSearchIndices</a></li><li><a href="global.html#getCurrentPriority">getCurrentPriority</a></li><li><a href="global.html#getDateWarning">getDateWarning</a></li><li><a href="global.html#getDescription">getDescription</a></li><li><a href="global.html#getDuedate">getDuedate</a></li><li><a href="global.html#getFirstThreeAssignments">getFirstThreeAssignments</a></li><li><a href="global.html#getFormData">getFormData</a></li><li><a href="global.html#getNextContactId">getNextContactId</a></li><li><a href="global.html#getProgressbarTemplate">getProgressbarTemplate</a></li><li><a href="global.html#getSingleSubtask">getSingleSubtask</a></li><li><a href="global.html#getSubtaskTxt">getSubtaskTxt</a></li><li><a href="global.html#getSubtasks">getSubtasks</a></li><li><a href="global.html#getTitle">getTitle</a></li><li><a href="global.html#groupContactsByLetter">groupContactsByLetter</a></li><li><a href="global.html#handleContactLoadError">handleContactLoadError</a></li><li><a href="global.html#handleCreateMode">handleCreateMode</a></li><li><a href="global.html#handleEditMode">handleEditMode</a></li><li><a href="global.html#handleLoginPasswordInput">handleLoginPasswordInput</a></li><li><a href="global.html#hideSelectionList">hideSelectionList</a></li><li><a href="global.html#initAddTaskOverlay">initAddTaskOverlay</a></li><li><a href="global.html#initAddTaskPage">initAddTaskPage</a></li><li><a href="global.html#initAssignedPersons">initAssignedPersons</a></li><li><a href="global.html#initContactSearchList">initContactSearchList</a></li><li><a href="global.html#initLoginAutoFill">initLoginAutoFill</a></li><li><a href="global.html#initTaskForm">initTaskForm</a></li><li><a href="global.html#initializeEventListeners">initializeEventListeners</a></li><li><a href="global.html#initializeMobileResizeHandler">initializeMobileResizeHandler</a></li><li><a href="global.html#isDateInFuture">isDateInFuture</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isLeapYear">isLeapYear</a></li><li><a href="global.html#loadAllContacts">loadAllContacts</a></li><li><a href="global.html#loadContactDataForEditPage">loadContactDataForEditPage</a></li><li><a href="global.html#loadContactDataForSuccessPage">loadContactDataForSuccessPage</a></li><li><a href="global.html#loadContactForEdit">loadContactForEdit</a></li><li><a href="global.html#loadContactScripts">loadContactScripts</a></li><li><a href="global.html#loadExistingContact">loadExistingContact</a></li><li><a href="global.html#loginButton">loginButton</a></li><li><a href="global.html#loginErrorContainer">loginErrorContainer</a></li><li><a href="global.html#loginGuest">loginGuest</a></li><li><a href="global.html#loginPwdIcon">loginPwdIcon</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#navigateToSuccessPage">navigateToSuccessPage</a></li><li><a href="global.html#openAddContactOverlay">openAddContactOverlay</a></li><li><a href="global.html#openMobileActionMenu">openMobileActionMenu</a></li><li><a href="global.html#overlayMessage">overlayMessage</a></li><li><a href="global.html#passwordIcon">passwordIcon</a></li><li><a href="global.html#passwordInput">passwordInput</a></li><li><a href="global.html#passwordInputField">passwordInputField</a></li><li><a href="global.html#removeDarkFixedLogoAfterAnimation">removeDarkFixedLogoAfterAnimation</a></li><li><a href="global.html#removeLightLogoAfterSplash">removeLightLogoAfterSplash</a></li><li><a href="global.html#removeOrAddWarning">removeOrAddWarning</a></li><li><a href="global.html#renderPersonIconsList">renderPersonIconsList</a></li><li><a href="global.html#resetExistingLoginError">resetExistingLoginError</a></li><li><a href="global.html#saveContact">saveContact</a></li><li><a href="global.html#saveContactToFirebase">saveContactToFirebase</a></li><li><a href="global.html#saveEditContactToFirebase">saveEditContactToFirebase</a></li><li><a href="global.html#selectContact">selectContact</a></li><li><a href="global.html#selectContactById">selectContactById</a></li><li><a href="global.html#selectPerson">selectPerson</a></li><li><a href="global.html#setAllButtonInactive">setAllButtonInactive</a></li><li><a href="global.html#setCurrentUserData">setCurrentUserData</a></li><li><a href="global.html#setDefaultIconPriority">setDefaultIconPriority</a></li><li><a href="global.html#setIconPriority">setIconPriority</a></li><li><a href="global.html#setPriorityButtonDefault">setPriorityButtonDefault</a></li><li><a href="global.html#setupClickOutsideToClose">setupClickOutsideToClose</a></li><li><a href="global.html#showCategorySelection">showCategorySelection</a></li><li><a href="global.html#showEmptyState">showEmptyState</a></li><li><a href="global.html#showErrorState">showErrorState</a></li><li><a href="global.html#showGenericLoginError">showGenericLoginError</a></li><li><a href="global.html#showLoadingState">showLoadingState</a></li><li><a href="global.html#showLoginErrorAndStop">showLoginErrorAndStop</a></li><li><a href="global.html#showMobileContactList">showMobileContactList</a></li><li><a href="global.html#showOverlayMessage">showOverlayMessage</a></li><li><a href="global.html#showStaticLogoAfterAnimation">showStaticLogoAfterAnimation</a></li><li><a href="global.html#showToastMessage">showToastMessage</a></li><li><a href="global.html#signupOverlay">signupOverlay</a></li><li><a href="global.html#simpleCheckDuedate">simpleCheckDuedate</a></li><li><a href="global.html#smoothLogoHandover">smoothLogoHandover</a></li><li><a href="global.html#storeUserInitials">storeUserInitials</a></li><li><a href="global.html#toggleCheckbox">toggleCheckbox</a></li><li><a href="global.html#toggleDropDownIcon">toggleDropDownIcon</a></li><li><a href="global.html#toggleDropDownSelection">toggleDropDownSelection</a></li><li><a href="global.html#toggleInputErrorDesign">toggleInputErrorDesign</a></li><li><a href="global.html#toggleLoginVisibility">toggleLoginVisibility</a></li><li><a href="global.html#toggleMobileActionMenu">toggleMobileActionMenu</a></li><li><a href="global.html#togglePriorityButtons">togglePriorityButtons</a></li><li><a href="global.html#toggleWarning">toggleWarning</a></li><li><a href="global.html#updateAvatarPreview">updateAvatarPreview</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateFieldValidation">updateFieldValidation</a></li><li><a href="global.html#updateSaveButtonState">updateSaveButtonState</a></li><li><a href="global.html#validateContactForm">validateContactForm</a></li><li><a href="global.html#validateEmail">validateEmail</a></li><li><a href="global.html#validateName">validateName</a></li><li><a href="global.html#validatePhone">validatePhone</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Oct 06 2025 14:22:22 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
