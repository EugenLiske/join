<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: add_task/task_form.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: add_task/task_form.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
let contactListNames = [];
let idxOfSearchedContacts = [];
let assignedPersons = [];

let nextSubtaskId = 0;

let formContacts = null;


function getContactListNames(){
    return contactListNames;
}


function getSearchedContacts(){
    return idxOfSearchedContacts;
}


function getAssigned(){
    return assignedPersons;
}


function getFormContacts(){
    return formContacts;
}


function setSubtaskId(subtaskId){
    nextSubtaskId = subtaskId;
}


// EventListener -------------------------------------------------------------------

/**
 * Global click event listener.
 * 
 * Closes any open dropdowns related to:
 * - Assigned persons selection
 * - Category selection
 * 
 * @param {MouseEvent} event - The click event object.
 */
document.addEventListener('click', function(event) {
    closeDropDownAssignedToSelection(event);
    closeDropDownCategorySelection(event);
});


function closeDropDownCategorySelection(event){
    const containerCategory = document.getElementById('selection_container_category');
    if (containerCategory &amp;&amp; !containerCategory.contains(event.target)) {
        hideSelectionList('category_options', 'drop_down_categories')
    }        
}


/**
 * Hides the selection list by adding the "d_none" class to the element with the given listId,
 * and toggles the dropdown icon associated with the list.
 *
 * @param {string} listId - The ID of the selection list element to hide.
 * @param {string} iconId - The ID of the dropdown icon element to toggle.
 */
function hideSelectionList(listId, iconId){
    document.getElementById(listId).classList.add("d_none");
    toggleDropDownIcon(listId, iconId);
}


function closeDropDownAssignedToSelection(event){
    const containerAssignedTo = document.getElementById('selection_container_assignedto');
    if (containerAssignedTo &amp;&amp; !containerAssignedTo.contains(event.target)) {
        if (!document.getElementById('selection').classList.contains("d_none")){
            toggleButtonAndInputElement();
        }
    }    
}


/**
 * Initializes the task form.
 * 
 * - Loads contact data and initializes the assigned persons array.
 * - Creates the dropdown list for contact search results.
 * - Renders category options.
 * - Resets the subtask ID counter.
 * 
 * @async
 */
async function initTaskForm(){
    formContacts = await getContacts();
    contactListNames = await initContactSearchList();
    assignedPersons = initAssignedPersons(contactListNames);
    
    idxOfSearchedContacts = getContactNameSearchIndices("", contactListNames);
    createContactDropDownSearchList(idxOfSearchedContacts, assignedPersons, formContacts);

    renderCategoryOptions();
    nextSubtaskId = 0;
}


/**
 * Toggles the visibility of a dropdown and its associated icon.
 * 
 * @param {string} listId - The ID of the dropdown list element.
 * @param {string} iconId - The ID of the dropdown icon element to toggle.
 */
function toggleDropDownSelection(listId, iconId){
    document.getElementById(listId).classList.toggle("d_none");
    toggleDropDownIcon(listId, iconId);
}


/**
 * Toggles the priority selection for a task.
 * 
 * @param {HTMLElement} element - The button element that was clicked.
 * @param {string} priority - The selected priority (e.g., 'urgent', 'medium', 'low').
 */
function togglePriorityButtons(element, priority){
    clearPriorityButtons("all");

    element.disabled = true;
    element.classList.replace(priority + "_color_default", priority + "_color_click");
    element.children[0].classList.remove("priority_btn_c_txt_default");
    element.children[1].src = setIconPriority(priority);
}


// Assigned to
function toggleButtonAndInputElement(){
    document.getElementById("task_assignedto_button").classList.toggle("d_none");
    document.getElementById("task_assignedto_input").classList.toggle("d_none");

    toggleDropDownSelection('selection', 'drop_down_persons');
    togglePersonIconsList();
}


function startNameSearch(){
    let input = document.getElementById("task_assignedto_input").value;
    idxOfSearchedContacts = getContactNameSearchIndices(input, contactListNames);
    createContactDropDownSearchList(idxOfSearchedContacts, assignedPersons, formContacts);
    document.getElementById("selection").classList.remove("d_none");
    toggleDropDownIcon("task_assignedto_input", "drop_down_persons");
}


/**
 * Toggles the selection of a person in the assigned contacts list.
 * 
 * - Updates the checkbox and visual state of the element.
 * - Updates the `assignedPersons` array accordingly.
 * - Re-renders the list of selected person icons.
 * 
 * @param {HTMLElement} element - The HTML element representing the person.
 * @param {number} personIdx - The index of the person in the `assignedPersons` array.
 */
function selectPerson(element, personIdx){
    element.classList.toggle("person_selected");

    let checkbox = getCheckbox(element);
    let checked = element.classList.contains("person_selected");
    toggleCheckbox(checked, checkbox);
    assignedPersons[personIdx] = checked;
    renderPersonIconsList(assignedPersons, formContacts);
}


function clearAssignedToInputArea(){
    clearPersonIcons();
    assignedPersons = initAssignedPersons(formContacts);
    idxOfSearchedContacts = getContactNameSearchIndices("", contactListNames);
    createContactDropDownSearchList(idxOfSearchedContacts, assignedPersons, formContacts);
    defaultAssignedInput();
}


/**
 * Returns an object containing the assigned persons for the current task.
 * 
 * - Iterates through the `assignedPersons` array.
 * - Maps assigned indices to their corresponding contact IDs.
 * 
 * @returns {Object} assigned - An object mapping contact keys to their IDs.
 */
function getAssignedPersons(){
    let assigned = {};
    let personsKeys = Object.keys(formContacts);
    for (let personIdx = 0; personIdx &lt; assignedPersons.length; personIdx++) {
        if (assignedPersons[personIdx]){
            let personKey = "contact_" + formContacts[personsKeys[personIdx]].id;
            
            assigned[personKey] = formContacts[personsKeys[personIdx]].id;
        }
    }
    return assigned;
}


// Category

function setCategorySelection(category){
    showCategorySelection(category);
    renderCategoryOptions();
}


// Subtasks

function addSubtaskOrToggleIcons(event){
    if (event.key === 'Enter' &amp;&amp; document.getElementById("subtask_input").value.length > 0) {
        addSubtaskToList();
    }
    else {
        toggleDeleteAndAddIcons();
    }
}


function addSubtaskToList(){
    let inputSubtask = document.getElementById("subtask_input");
    let input = inputSubtask.value;
    let subtasksContainer = document.getElementById("subtasks_container");
    subtasksContainer.innerHTML += getSubtaskTemplate(input, nextSubtaskId);
    nextSubtaskId++;
    inputSubtask.value = "";
    toggleDeleteAndAddIcons();
}


function cancelSubtask(){
    let inputSubtask = document.getElementById("subtask_input");
    inputSubtask.value = "";
    toggleDeleteAndAddIcons();
}


function deleteSubtask(event, subtaskID) {
    event.stopPropagation();
    
    document.getElementById("subtask_element_" + subtaskID).remove();
}


function openEditMode(subtaskID){
    document.getElementById("edit_mode_" + subtaskID).classList.remove("d_none");
}


function saveAndCloseEditMode(event, subtaskID){
    event.stopPropagation();

    let input = document.getElementById("edit_subtask_input_" + subtaskID).value;
    document.getElementById("subtask_" + subtaskID).innerText = input;
    document.getElementById("edit_mode_" + subtaskID).classList.add("d_none");
}


// Create Task or Ok Button

function checkAndEnableButton(mode = "add_task"){
    let createButtonRef = document.getElementById("create_task_button");
    if (checkRequiredFieldsToEnableButton(mode)){
        createButtonRef.disabled = false;
    }
    else {
        createButtonRef.disabled = true;
    }
}


function deleteTaskForm(kind = "add"){
    if (kind === "add")
        document.getElementById("add_task_form").innerHTML = "";
    else if (kind === "edit"){
        document.getElementById("edit_task_form").innerHTML = "";
    }
}


/**
 * Toggles the dropdown icon based on the visibility of the selection element.
 *
 * @param {string} inputId - The ID of the selection list element to hide.
 * @param {string} iconId - The ID of the image element representing the dropdown icon.
 */
function toggleDropDownIcon(inputId, iconId){
    let selectionRef = document.getElementById(inputId);
    let dropDownRef = document.getElementById(iconId);

    if (selectionRef.classList.contains("d_none")){
        dropDownRef.src="../assets/img/icons/drop_down/arrow.svg";
    }
    else{
        dropDownRef.src="../assets/img/icons/drop_down/arrow_close.svg";
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#assignRandomAvatarColor">assignRandomAvatarColor</a></li><li><a href="global.html#checkCategory">checkCategory</a></li><li><a href="global.html#checkCategorySelection">checkCategorySelection</a></li><li><a href="global.html#checkDate">checkDate</a></li><li><a href="global.html#checkDateFormat">checkDateFormat</a></li><li><a href="global.html#checkDuedate">checkDuedate</a></li><li><a href="global.html#checkEmailExists">checkEmailExists</a></li><li><a href="global.html#checkEmailExistsForEdit">checkEmailExistsForEdit</a></li><li><a href="global.html#checkIfOldSubtaskExists">checkIfOldSubtaskExists</a></li><li><a href="global.html#checkLoginEnable">checkLoginEnable</a></li><li><a href="global.html#checkNumberInterval">checkNumberInterval</a></li><li><a href="global.html#checkRequiredFields">checkRequiredFields</a></li><li><a href="global.html#checkRequiredFieldsToEnableButton">checkRequiredFieldsToEnableButton</a></li><li><a href="global.html#checkSingleUserMatch">checkSingleUserMatch</a></li><li><a href="global.html#checkTitle">checkTitle</a></li><li><a href="global.html#clearFormInputs">clearFormInputs</a></li><li><a href="global.html#clearPriorityButtons">clearPriorityButtons</a></li><li><a href="global.html#closeEditContact">closeEditContact</a></li><li><a href="global.html#closeMobileActionMenu">closeMobileActionMenu</a></li><li><a href="global.html#createContactDropDownSearchList">createContactDropDownSearchList</a></li><li><a href="global.html#createContactDropDownSearchListElement">createContactDropDownSearchListElement</a></li><li><a href="global.html#createContactElement">createContactElement</a></li><li><a href="global.html#createSuccessOverlayLogin">createSuccessOverlayLogin</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#dateValidation">dateValidation</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactFromFirebase">deleteContactFromFirebase</a></li><li><a href="global.html#deleteContactFromSuccessPage">deleteContactFromSuccessPage</a></li><li><a href="global.html#deleteSelectedContact">deleteSelectedContact</a></li><li><a href="global.html#displayContactDataInForm">displayContactDataInForm</a></li><li><a href="global.html#displayContactDetails">displayContactDetails</a></li><li><a href="global.html#displayContactsList">displayContactsList</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#editSelectedContact">editSelectedContact</a></li><li><a href="global.html#emailInput">emailInput</a></li><li><a href="global.html#extractSubtaskNrFromId">extractSubtaskNrFromId</a></li><li><a href="global.html#findMatchingUser">findMatchingUser</a></li><li><a href="global.html#generateInitials">generateInitials</a></li><li><a href="global.html#getAllUsers">getAllUsers</a></li><li><a href="global.html#getAssignedPersons">getAssignedPersons</a></li><li><a href="global.html#getCheckbox">getCheckbox</a></li><li><a href="global.html#getCheckboxImg">getCheckboxImg</a></li><li><a href="global.html#getContactNameSearchIndices">getContactNameSearchIndices</a></li><li><a href="global.html#getCurrentPriority">getCurrentPriority</a></li><li><a href="global.html#getDateWarning">getDateWarning</a></li><li><a href="global.html#getDescription">getDescription</a></li><li><a href="global.html#getDuedate">getDuedate</a></li><li><a href="global.html#getFirstThreeAssignments">getFirstThreeAssignments</a></li><li><a href="global.html#getFormData">getFormData</a></li><li><a href="global.html#getNextContactId">getNextContactId</a></li><li><a href="global.html#getProgressbarTemplate">getProgressbarTemplate</a></li><li><a href="global.html#getSingleSubtask">getSingleSubtask</a></li><li><a href="global.html#getSubtaskTxt">getSubtaskTxt</a></li><li><a href="global.html#getSubtasks">getSubtasks</a></li><li><a href="global.html#getTitle">getTitle</a></li><li><a href="global.html#groupContactsByLetter">groupContactsByLetter</a></li><li><a href="global.html#handleContactLoadError">handleContactLoadError</a></li><li><a href="global.html#handleCreateMode">handleCreateMode</a></li><li><a href="global.html#handleEditMode">handleEditMode</a></li><li><a href="global.html#handleLoginPasswordInput">handleLoginPasswordInput</a></li><li><a href="global.html#hideSelectionList">hideSelectionList</a></li><li><a href="global.html#initAddTaskOverlay">initAddTaskOverlay</a></li><li><a href="global.html#initAddTaskPage">initAddTaskPage</a></li><li><a href="global.html#initAssignedPersons">initAssignedPersons</a></li><li><a href="global.html#initContactSearchList">initContactSearchList</a></li><li><a href="global.html#initLoginAutoFill">initLoginAutoFill</a></li><li><a href="global.html#initTaskForm">initTaskForm</a></li><li><a href="global.html#initializeEventListeners">initializeEventListeners</a></li><li><a href="global.html#initializeMobileResizeHandler">initializeMobileResizeHandler</a></li><li><a href="global.html#isDateInFuture">isDateInFuture</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isLeapYear">isLeapYear</a></li><li><a href="global.html#loadAllContacts">loadAllContacts</a></li><li><a href="global.html#loadContactDataForEditPage">loadContactDataForEditPage</a></li><li><a href="global.html#loadContactDataForSuccessPage">loadContactDataForSuccessPage</a></li><li><a href="global.html#loadContactForEdit">loadContactForEdit</a></li><li><a href="global.html#loadContactScripts">loadContactScripts</a></li><li><a href="global.html#loadExistingContact">loadExistingContact</a></li><li><a href="global.html#loginButton">loginButton</a></li><li><a href="global.html#loginErrorContainer">loginErrorContainer</a></li><li><a href="global.html#loginGuest">loginGuest</a></li><li><a href="global.html#loginPwdIcon">loginPwdIcon</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#navigateToSuccessPage">navigateToSuccessPage</a></li><li><a href="global.html#openAddContactOverlay">openAddContactOverlay</a></li><li><a href="global.html#openMobileActionMenu">openMobileActionMenu</a></li><li><a href="global.html#overlayMessage">overlayMessage</a></li><li><a href="global.html#passwordIcon">passwordIcon</a></li><li><a href="global.html#passwordInput">passwordInput</a></li><li><a href="global.html#passwordInputField">passwordInputField</a></li><li><a href="global.html#removeDarkFixedLogoAfterAnimation">removeDarkFixedLogoAfterAnimation</a></li><li><a href="global.html#removeLightLogoAfterSplash">removeLightLogoAfterSplash</a></li><li><a href="global.html#removeOrAddWarning">removeOrAddWarning</a></li><li><a href="global.html#renderPersonIconsList">renderPersonIconsList</a></li><li><a href="global.html#resetExistingLoginError">resetExistingLoginError</a></li><li><a href="global.html#saveContact">saveContact</a></li><li><a href="global.html#saveContactToFirebase">saveContactToFirebase</a></li><li><a href="global.html#saveEditContactToFirebase">saveEditContactToFirebase</a></li><li><a href="global.html#selectContact">selectContact</a></li><li><a href="global.html#selectContactById">selectContactById</a></li><li><a href="global.html#selectPerson">selectPerson</a></li><li><a href="global.html#setAllButtonInactive">setAllButtonInactive</a></li><li><a href="global.html#setCurrentUserData">setCurrentUserData</a></li><li><a href="global.html#setDefaultIconPriority">setDefaultIconPriority</a></li><li><a href="global.html#setIconPriority">setIconPriority</a></li><li><a href="global.html#setPriorityButtonDefault">setPriorityButtonDefault</a></li><li><a href="global.html#setupClickOutsideToClose">setupClickOutsideToClose</a></li><li><a href="global.html#showCategorySelection">showCategorySelection</a></li><li><a href="global.html#showEmptyState">showEmptyState</a></li><li><a href="global.html#showErrorState">showErrorState</a></li><li><a href="global.html#showGenericLoginError">showGenericLoginError</a></li><li><a href="global.html#showLoadingState">showLoadingState</a></li><li><a href="global.html#showLoginErrorAndStop">showLoginErrorAndStop</a></li><li><a href="global.html#showMobileContactList">showMobileContactList</a></li><li><a href="global.html#showOverlayMessage">showOverlayMessage</a></li><li><a href="global.html#showStaticLogoAfterAnimation">showStaticLogoAfterAnimation</a></li><li><a href="global.html#showToastMessage">showToastMessage</a></li><li><a href="global.html#signupOverlay">signupOverlay</a></li><li><a href="global.html#simpleCheckDuedate">simpleCheckDuedate</a></li><li><a href="global.html#smoothLogoHandover">smoothLogoHandover</a></li><li><a href="global.html#storeUserInitials">storeUserInitials</a></li><li><a href="global.html#toggleCheckbox">toggleCheckbox</a></li><li><a href="global.html#toggleDropDownIcon">toggleDropDownIcon</a></li><li><a href="global.html#toggleDropDownSelection">toggleDropDownSelection</a></li><li><a href="global.html#toggleInputErrorDesign">toggleInputErrorDesign</a></li><li><a href="global.html#toggleLoginVisibility">toggleLoginVisibility</a></li><li><a href="global.html#toggleMobileActionMenu">toggleMobileActionMenu</a></li><li><a href="global.html#togglePriorityButtons">togglePriorityButtons</a></li><li><a href="global.html#toggleWarning">toggleWarning</a></li><li><a href="global.html#updateAvatarPreview">updateAvatarPreview</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateFieldValidation">updateFieldValidation</a></li><li><a href="global.html#updateSaveButtonState">updateSaveButtonState</a></li><li><a href="global.html#validateContactForm">validateContactForm</a></li><li><a href="global.html#validateEmail">validateEmail</a></li><li><a href="global.html#validateName">validateName</a></li><li><a href="global.html#validatePhone">validatePhone</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Oct 06 2025 14:22:22 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
